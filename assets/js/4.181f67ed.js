(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{164:function(s,a,t){s.exports=t.p+"assets/img/Seata_02.f8f35a4c.png"},205:function(s,a,t){s.exports=t.p+"assets/img/nacos_config.52c59640.png"},206:function(s,a,t){s.exports=t.p+"assets/img/nacos_windows.c9e9cf0e.png"},207:function(s,a,t){s.exports=t.p+"assets/img/nacos_startup.bf4e3bc3.png"},208:function(s,a,t){s.exports=t.p+"assets/img/nacos_startup2.e12f54fb.png"},209:function(s,a,t){s.exports=t.p+"assets/img/nginx_conf.c05868f2.png"},210:function(s,a){s.exports="data:image/png;base64,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"},211:function(s,a,t){s.exports=t.p+"assets/img/sentinel.5e916f2a.png"},212:function(s,a,t){s.exports=t.p+"assets/img/Sentinel_main.2caac931.png"},213:function(s,a,t){s.exports=t.p+"assets/img/Sentinel_testA.d336fecf.png"},214:function(s,a,t){s.exports=t.p+"assets/img/Sentinel_RT.ae7b0ccc.png"},215:function(s,a,t){s.exports=t.p+"assets/img/Sentinel_error.57550506.png"},216:function(s,a,t){s.exports=t.p+"assets/img/Sentinel_err_num.0f659b87.png"},217:function(s,a,t){s.exports=t.p+"assets/img/Sentinel_hot.5ecacfb1.png"},218:function(s,a,t){s.exports=t.p+"assets/img/Sentinel_hot_myhot.1239cc18.png"},219:function(s,a,t){s.exports=t.p+"assets/img/nacos_sentinel.d0892145.png"},220:function(s,a,t){s.exports=t.p+"assets/img/seata.069e2056.png"},221:function(s,a){s.exports="data:image/png;base64,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"},222:function(s,a,t){s.exports=t.p+"assets/img/seata_tables.3124e2e6.png"},223:function(s,a,t){s.exports=t.p+"assets/img/seata_end.e2dad7de.png"},224:function(s,a,t){s.exports=t.p+"assets/img/Seata_01.02815129.png"},263:function(s,a,t){"use strict";t.r(a);var n=t(28),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"springcloudalibaba"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#springcloudalibaba"}},[s._v("#")]),s._v(" SpringCloudAlibaba")]),s._v(" "),n("h2",{attrs:{id:"入门简介"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#入门简介"}},[s._v("#")]),s._v(" 入门简介")]),s._v(" "),n("h3",{attrs:{id:"为什么会出现springcloudalibaba？"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#为什么会出现springcloudalibaba？"}},[s._v("#")]),s._v(" 为什么会出现SpringCloudAlibaba？")]),s._v(" "),n("p",[s._v("Spring CLoud Netflix 项目进入维护模式")]),s._v(" "),n("h2",{attrs:{id:"nacos服务注册和配置中心"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nacos服务注册和配置中心"}},[s._v("#")]),s._v(" Nacos服务注册和配置中心")]),s._v(" "),n("h3",{attrs:{id:"官网"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#官网"}},[s._v("#")]),s._v(" 官网")]),s._v(" "),n("p",[s._v("https://nacos.io/en-us/")]),s._v(" "),n("h3",{attrs:{id:"开始使用注册中心与配置中心"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#开始使用注册中心与配置中心"}},[s._v("#")]),s._v(" 开始使用注册中心与配置中心")]),s._v(" "),n("p",[s._v("Nacos自带ribbon所以支持负载均衡，并采用默认轮询算法")]),s._v(" "),n("p",[s._v("启动后控制台页面")]),s._v(" "),n("p",[s._v("http://localhost:8848/nacos/#/login")]),s._v(" "),n("p",[s._v("注册中心直接看官方文档，很简单")]),s._v(" "),n("p",[s._v("https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html")]),s._v(" "),n("p",[s._v("中文文档：")]),s._v(" "),n("p",[s._v("https://nacos.io/zh-cn/docs/cluster-mode-quick-start.html")]),s._v(" "),n("h4",{attrs:{id:"配置管理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置管理"}},[s._v("#")]),s._v(" 配置管理")]),s._v(" "),n("p",[s._v("Nacos有三层：")]),s._v(" "),n("p",[s._v("spring.cloud.nacos.config.namespace > spring.cloud.nacos.config.group > spring.profile.active")]),s._v(" "),n("p",[s._v("命名空间（例如华北机房与华南机房） > 分组（例如开发组与测试组） > 环境（例如开发环境，测试环境）")]),s._v(" "),n("p",[s._v("大概看这张图就差不多懂了")]),s._v(" "),n("p",[n("img",{attrs:{src:t(205),alt:"An image"}})]),s._v(" "),n("h3",{attrs:{id:"集群和持久化配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#集群和持久化配置"}},[s._v("#")]),s._v(" 集群和持久化配置")]),s._v(" "),n("h4",{attrs:{id:"nacos切换数据库-windows"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nacos切换数据库-windows"}},[s._v("#")]),s._v(" Nacos切换数据库(windows)")]),s._v(" "),n("p",[s._v("自带嵌入式数据库derby切换到mysql")]),s._v(" "),n("p",[s._v("执行安装目录的conf目录下的nacos-mysql.sql脚本初始化数据库环境")]),s._v(" "),n("p",[s._v("官网内容：")]),s._v(" "),n("p",[n("img",{attrs:{src:t(206),alt:"An image"}})]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[s._v("spring"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("datasource"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("platform"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mysql\n\ndb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("num"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\ndb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("jdbc"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("mysql"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("11.162")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".196")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".16")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nacos_devtest"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v("characterEncoding"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf8"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("connectTimeout"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("socketTimeout"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("autoReconnect"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\ndb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("user"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nacos_devtest\ndb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("password"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("youdontknow\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[s._v("由于机器装的8.0.19mysql，单机版不支持不想下源码修改，然后就跳过")]),s._v(" "),n("p",[s._v("如果修改源码成功打包，配置的时候jdbc要加：serverTimezone=GMT%2B8 时区来适应mysql8")]),s._v(" "),n("h3",{attrs:{id:"nacos集群"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nacos集群"}},[s._v("#")]),s._v(" Nacos集群")]),s._v(" "),n("h4",{attrs:{id:"配置集群步骤"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置集群步骤"}},[s._v("#")]),s._v(" 配置集群步骤")]),s._v(" "),n("h5",{attrs:{id:"_1-linux服务器上mysql数据库配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-linux服务器上mysql数据库配置"}},[s._v("#")]),s._v(" 1.Linux服务器上mysql数据库配置")]),s._v(" "),n("p",[s._v("如上【Nacos切换数据库】")]),s._v(" "),n("h4",{attrs:{id:"_2-修改集群地址配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-修改集群地址配置"}},[s._v("#")]),s._v(" 2.修改集群地址配置")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 先复制一份")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" cluster.conf.example cluster.conf\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改我们复制的")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 要在里面填写 hostname -i 查看的真实ip地址")]),s._v("\ncluster.conf\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("h4",{attrs:{id:"_3-修改startup-sh"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-修改startup-sh"}},[s._v("#")]),s._v(" 3.修改startup.sh")]),s._v(" "),n("p",[n("img",{attrs:{src:t(207),alt:"An image"}})]),s._v(" "),n("p",[n("img",{attrs:{src:t(208),alt:"An image"}})]),s._v(" "),n("h4",{attrs:{id:"_4-配置nginx-conf"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-配置nginx-conf"}},[s._v("#")]),s._v(" 4.配置nginx.conf")]),s._v(" "),n("p",[n("img",{attrs:{src:t(209),alt:"An image"}})]),s._v(" "),n("h4",{attrs:{id:"_5-启动nginx"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-启动nginx"}},[s._v("#")]),s._v(" 5.启动nginx")]),s._v(" "),n("p",[s._v("./nginx -c /apps/myNginx/conf/nginx.conf")]),s._v(" "),n("h4",{attrs:{id:"_6-访问nginx的http-192-168-172-22-1111-nacos-新建配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-访问nginx的http-192-168-172-22-1111-nacos-新建配置"}},[s._v("#")]),s._v(" 6.访问nginx的http://192.168.172.22:1111/nacos/新建配置")]),s._v(" "),n("p",[s._v("可以看到数据库有数据表示搭建完成")]),s._v(" "),n("p",[n("img",{attrs:{src:t(210),alt:"An image"}})]),s._v(" "),n("h2",{attrs:{id:"sentinel-实现熔断与限流"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#sentinel-实现熔断与限流"}},[s._v("#")]),s._v(" Sentinel 实现熔断与限流")]),s._v(" "),n("h3",{attrs:{id:"sentinel启动"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#sentinel启动"}},[s._v("#")]),s._v(" Sentinel启动")]),s._v(" "),n("p",[s._v("下载的是sentinel-dashboard-1.7.0.jar，java -jar启动即可")]),s._v(" "),n("p",[s._v("默认端口8080，账号密码sentinel")]),s._v(" "),n("p",[s._v("启动后就能访问控制台了，很方便")]),s._v(" "),n("p",[n("img",{attrs:{src:t(211),alt:"An image"}})]),s._v(" "),n("h3",{attrs:{id:"新建8401测试微服务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#新建8401测试微服务"}},[s._v("#")]),s._v(" 新建8401测试微服务")]),s._v(" "),n("h4",{attrs:{id:"添加sentinel依赖"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#添加sentinel依赖"}},[s._v("#")]),s._v(" 添加Sentinel依赖")]),s._v(" "),n("div",{staticClass:"language-xml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-xml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!-- sentinel --\x3e")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("com.alibaba.cloud"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("spring-cloud-starter-alibaba-sentinel"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h4",{attrs:{id:"配置连接sentinel"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置连接sentinel"}},[s._v("#")]),s._v(" 配置连接Sentinel")]),s._v(" "),n("div",{staticClass:"language-yml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("server")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8401")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spring")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("application")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" cloudalibaba"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("sentinel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("service\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cloud")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nacos")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("discovery")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("server-addr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 192.168.172.22"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1111  ")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nacos注册中心")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("sentinel")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("transport")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dashboard")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 192.168.172.22"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080  ")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#sentinel地址")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认8719端口，假如占用会自动从8719开始依次+1扫描，直至找到未被占用的端口")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8719")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("management")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("endpoints")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("web")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("exposure")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("include")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*'")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br")])]),n("h4",{attrs:{id:"做一个controller-里面就两个简单的接口"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#做一个controller-里面就两个简单的接口"}},[s._v("#")]),s._v(" 做一个controller,里面就两个简单的接口")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("package")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hzh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cloudalibaba"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("contoller")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("springframework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("web"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("bind"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("annotation")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("GetMapping")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("springframework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("web"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("bind"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("annotation")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RestController")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@RestController")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FlowLimitController")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@GetMapping")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/testA"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("testA")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-----testA"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@GetMapping")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/testB"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("testB")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-----testB"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("h4",{attrs:{id:"启动访问"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#启动访问"}},[s._v("#")]),s._v(" 启动访问")]),s._v(" "),n("p",[s._v("Sentinel是懒加载的模式，需要访问一次接口才能有监控信息")]),s._v(" "),n("p",[n("img",{attrs:{src:t(212),alt:"An image"}})]),s._v(" "),n("h3",{attrs:{id:"流控模式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#流控模式"}},[s._v("#")]),s._v(" 流控模式")]),s._v(" "),n("h4",{attrs:{id:"testa-每秒只允许请求一次"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#testa-每秒只允许请求一次"}},[s._v("#")]),s._v(" testA 每秒只允许请求一次")]),s._v(" "),n("p",[n("img",{attrs:{src:t(213),alt:"An image"}})]),s._v(" "),n("h4",{attrs:{id:"流控模式规则说明"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#流控模式规则说明"}},[s._v("#")]),s._v(" 流控模式规则说明")]),s._v(" "),n("ul",[n("li",[s._v("资源名：唯一名称，默认请求路径")]),s._v(" "),n("li",[s._v("针对来源：Sentinel可以针对调用者进行限流，填写微服务名，默认default（不区分来源）")]),s._v(" "),n("li",[s._v("阈值类型/单机阈值：\n"),n("ul",[n("li",[s._v("QPS(每秒钟的请求数量)：当调用该api的QPS达到阈值的时候，进行限流")]),s._v(" "),n("li",[s._v("线程数：当调用该api的线程数达到阈值的时候，进行限流")])])]),s._v(" "),n("li",[s._v("是否集群：不需要集群")]),s._v(" "),n("li",[s._v("流控模式：\n"),n("ul",[n("li",[s._v("直接：api达到限流条件时，直接限流")]),s._v(" "),n("li",[s._v("关联：当关联的资源达到阈值时，就限流自己")]),s._v(" "),n("li",[s._v("链路：只记录指定链路上的流量（指定资源从入口资源进来的流量，如果达到阈值，就进行限流）【api级别的针对来源】")])])]),s._v(" "),n("li",[s._v("流控效果：\n"),n("ul",[n("li",[s._v("快速失败：直接失败，抛异常")]),s._v(" "),n("li",[s._v("Warm Up：即预热/冷启动方式。在预热时长内先根据阈值/codeFactor（冷加载因子，默认3）的值流控，经过预热时长，才达到设置的QPS阈值")]),s._v(" "),n("li",[s._v("排队等待：匀速排队，让请求以均匀的速度通过，阈值类型必须设置成QPS，否则无效。")])])])]),s._v(" "),n("h3",{attrs:{id:"熔断降级"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#熔断降级"}},[s._v("#")]),s._v(" 熔断降级")]),s._v(" "),n("ul",[n("li",[s._v("官网说明： https://github.com/alibaba/Sentinel/wiki/%E7%86%94%E6%96%AD%E9%99%8D%E7%BA%A7")])]),s._v(" "),n("h4",{attrs:{id:"降级策略"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#降级策略"}},[s._v("#")]),s._v(" 降级策略")]),s._v(" "),n("ul",[n("li",[s._v("RT(平均响应时间)")])]),s._v(" "),n("p",[s._v("当 1s 内持续进入 5 个请求，对应时刻的平均响应时间（秒级）均超过阈值（count，以 ms 为单位），那么在接下的时间窗口（DegradeRule 中的 timeWindow，以 s 为单位）之内，对这个方法的调用都会自动地熔断（抛出 DegradeException）。注意 Sentinel 默认统计的 RT 上限是 4900 ms，超出此阈值的都会算作 4900 ms，若需要变更此上限可以通过启动配置项 -Dcsp.sentinel.statistic.max.rt=xxx 来配置。")]),s._v(" "),n("p",[n("img",{attrs:{src:t(214),alt:"An image"}})]),s._v(" "),n("ul",[n("li",[s._v("异常比例")])]),s._v(" "),n("p",[s._v("当资源的每秒请求量 >= 5，并且每秒异常总数占通过量的比值超过阈值（DegradeRule 中的 count）之后，资源进入降级状态，即在接下的时间窗口（DegradeRule 中的 timeWindow，以 s 为单位）之内，对这个方法的调用都会自动地返回。异常比率的阈值范围是 [0.0, 1.0]，代表 0% - 100%。")]),s._v(" "),n("p",[n("img",{attrs:{src:t(215),alt:"An image"}})]),s._v(" "),n("p",[s._v("每秒进20个线程，阈值设置0.8，时间窗口设置1，请求方法写的是10/0。\n结果请求量>5，异常比例100%，跳闸")]),s._v(" "),n("ul",[n("li",[s._v("异常数")])]),s._v(" "),n("p",[s._v("当资源近 1 分钟的异常数目超过阈值之后会进行熔断。注意由于统计时间窗口是分钟级别的，若 timeWindow 小于 60s，则结束熔断状态后仍可能再进入熔断状态。")]),s._v(" "),n("p",[n("img",{attrs:{src:t(216),alt:"An image"}})]),s._v(" "),n("p",[s._v("上图意思是，当异常数达到5个时，触发降级，在70s后回复。")]),s._v(" "),n("h3",{attrs:{id:"热点规则"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#热点规则"}},[s._v("#")]),s._v(" 热点规则")]),s._v(" "),n("ul",[n("li",[s._v("官网说明：\nhttps://github.com/alibaba/Sentinel/wiki/%E7%83%AD%E7%82%B9%E5%8F%82%E6%95%B0%E9%99%90%E6%B5%81")])]),s._v(" "),n("h4",{attrs:{id:"overview"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#overview"}},[s._v("#")]),s._v(" Overview")]),s._v(" "),n("p",[s._v("何为热点？热点即经常访问的数据。很多时候我们希望统计某个热点数据中访问频次最高的 Top K 数据，并对其访问进行限制。比如：")]),s._v(" "),n("ul",[n("li",[s._v("商品 ID 为参数，统计一段时间内最常购买的商品 ID 并进行限制")]),s._v(" "),n("li",[s._v("用户 ID 为参数，针对一段时间内频繁访问的用户 ID 进行限制")])]),s._v(" "),n("p",[s._v("热点参数限流会统计传入参数中的热点参数，并根据配置的限流阈值与模式，对包含热点参数的资源调用进行限流。热点参数限流可以看做是一种特殊的流量控制，仅对包含热点参数的资源调用生效。")]),s._v(" "),n("p",[n("img",{attrs:{src:t(217),alt:"An image"}})]),s._v(" "),n("p",[s._v("Sentinel 利用 LRU 策略统计最近最常访问的热点参数，结合令牌桶算法来进行参数级别的流控。热点参数限流支持集群模式。")]),s._v(" "),n("p",[s._v("根据官网所描述的，用自己的方式再描述一下")]),s._v(" "),n("p",[n("img",{attrs:{src:t(218),alt:"An image"}})]),s._v(" "),n("ul",[n("li",[s._v("资源名：@SentinelResource的value")]),s._v(" "),n("li",[s._v("QPS模式：每秒超过阈值则降级")]),s._v(" "),n("li",[s._v("参数索引：在接口的下标为0（就是第一个）参数")]),s._v(" "),n("li",[s._v("单机阈值：1秒内若带着索引为0（第一个）参数请求次数大于1，拉闸")]),s._v(" "),n("li",[s._v("统计窗口时长：1秒内恢复正常")])]),s._v(" "),n("p",[s._v("参数额外项")]),s._v(" "),n("ul",[n("li",[s._v("参数类型：controller参数接收类型")]),s._v(" "),n("li",[s._v("参考值：当索引0的参数为6时，指定一个限流阈值")]),s._v(" "),n("li",[s._v("限流阈值：当索引0的参数为6时，指定一个限流阈值")])]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@GetMapping")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/testHotKey"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@SentinelResource")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("value "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"testHotKey"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("blockHandler "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"deal_testHotKey"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("testHotKey")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@RequestParam")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("value "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"p1"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("required "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" p1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                         "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@RequestParam")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("value "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"p2"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("required "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" p2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"----testHotKey"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("deal_testHotKey")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" p1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" p2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BlockException")]),s._v(" exception"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-----deal_testHotKey,/(ㄒoㄒ)/~~"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("h3",{attrs:{id:"系统自适应限流"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#系统自适应限流"}},[s._v("#")]),s._v(" 系统自适应限流")]),s._v(" "),n("ul",[n("li",[s._v("官网说明\nhttps://github.com/alibaba/Sentinel/wiki/%E7%B3%BB%E7%BB%9F%E8%87%AA%E9%80%82%E5%BA%94%E9%99%90%E6%B5%81")])]),s._v(" "),n("p",[s._v("Sentinel 系统自适应限流从整体维度对应用入口流量进行控制，结合应用的 Load、CPU 使用率、总体平均 RT、入口 QPS 和并发线程数等几个维度的监控指标，通过自适应的流控策略，让系统的入口流量和系统的负载达到一个平衡，让系统尽可能跑在最大吞吐量的同时保证系统整体的稳定性。")]),s._v(" "),n("h4",{attrs:{id:"背景"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[s._v("#")]),s._v(" 背景")]),s._v(" "),n("p",[s._v("在开始之前，我们先了解一下系统保护的目的：")]),s._v(" "),n("ul",[n("li",[s._v("保证系统不被拖垮")]),s._v(" "),n("li",[s._v("在系统稳定的前提下，保持系统的吞吐量")])]),s._v(" "),n("p",[s._v("长期以来，系统保护的思路是根据硬指标，即系统的负载 (load1) 来做系统过载保护。当系统负载高于某个阈值，就禁止或者减少流量的进入；当 load 开始好转，则恢复流量的进入。这个思路给我们带来了不可避免的两个问题：")]),s._v(" "),n("ul",[n("li",[s._v("load 是一个“结果”，如果根据 load 的情况来调节流量的通过率，那么就始终有延迟性。也就意味着通过率的任何调整，都会过一段时间才能看到效果。当前通过率是使 load 恶化的一个动作，那么也至少要过 1 秒之后才能观测到；同理，如果当前通过率调整是让 load 好转的一个动作，也需要 1 秒之后才能继续调整，这样就浪费了系统的处理能力。所以我们看到的曲线，总是会有抖动。")]),s._v(" "),n("li",[s._v("恢复慢。想象一下这样的一个场景（真实），出现了这样一个问题，下游应用不可靠，导致应用 RT 很高，从而 load 到了一个很高的点。过了一段时间之后下游应用恢复了，应用 RT 也相应减少。这个时候，其实应该大幅度增大流量的通过率；但是由于这个时候 load 仍然很高，通过率的恢复仍然不高。")])]),s._v(" "),n("p",[s._v("TCP BBR 的思想给了我们一个很大的启发。我们应该根据系统能够处理的请求，和允许进来的请求，来做平衡，而不是根据一个间接的指标（系统 load）来做限流。最终我们追求的目标是 在系统不被拖垮的情况下，提高系统的吞吐率，而不是 load 一定要到低于某个阈值。如果我们还是按照固有的思维，超过特定的 load 就禁止流量进入，系统 load 恢复就放开流量，这样做的结果是无论我们怎么调参数，调比例，都是按照果来调节因，都无法取得良好的效果。")]),s._v(" "),n("p",[s._v("Sentinel 在系统自适应保护的做法是，用 load1 作为启动自适应保护的因子，而允许通过的流量由处理请求的能力，即请求的响应时间以及当前系统正在处理的请求速率来决定。")]),s._v(" "),n("h4",{attrs:{id:"系统规则"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#系统规则"}},[s._v("#")]),s._v(" 系统规则")]),s._v(" "),n("p",[s._v("系统保护规则是从应用级别的入口流量进行控制，从单台机器的 load、CPU 使用率、平均 RT、入口 QPS 和并发线程数等几个维度监控应用指标，让系统尽可能跑在最大吞吐量的同时保证系统整体的稳定性。")]),s._v(" "),n("p",[s._v("系统保护规则是应用整体维度的，而不是资源维度的，并且仅对入口流量生效。入口流量指的是进入应用的流量（EntryType.IN），比如 Web 服务或 Dubbo 服务端接收的请求，都属于入口流量。")]),s._v(" "),n("p",[s._v("系统规则支持以下的模式：")]),s._v(" "),n("ul",[n("li",[s._v("Load 自适应（仅对 Linux/Unix-like 机器生效）：系统的 load1 作为启发指标，进行自适应系统保护。当系统 load1 超过设定的启发值，且系统当前的并发线程数超过估算的系统容量时才会触发系统保护（BBR 阶段）。系统容量由系统的 maxQps * minRt 估算得出。设定参考值一般是 CPU cores * 2.5。")]),s._v(" "),n("li",[s._v("CPU usage（1.5.0+ 版本）：当系统 CPU 使用率超过阈值即触发系统保护（取值范围 0.0-1.0），比较灵敏。")]),s._v(" "),n("li",[s._v("平均 RT：当单台机器上所有入口流量的平均 RT 达到阈值即触发系统保护，单位是毫秒。")]),s._v(" "),n("li",[s._v("并发线程数：当单台机器上所有入口流量的并发线程数达到阈值即触发系统保护。")]),s._v(" "),n("li",[s._v("入口 QPS：当单台机器上所有入口流量的 QPS 达到阈值即触发系统保护。")])]),s._v(" "),n("h3",{attrs:{id:"sentinelresource-自定义限流处理逻辑"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#sentinelresource-自定义限流处理逻辑"}},[s._v("#")]),s._v(" @SentinelResource 自定义限流处理逻辑")]),s._v(" "),n("p",[s._v("定义全局限流异常处理类，注意方法必须为static")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("package")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hzh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cloudalibaba"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("myhandler")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("alibaba"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("csp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sentinel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("slots"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("block")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BlockException")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hzh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("springcloud"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("entities")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CommonResult")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n * 自定义限流处理逻辑\n */")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CustomerBlockHandler")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CommonResult")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("handlerException")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BlockException")]),s._v(" exception"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CommonResult")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("444")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("exception"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getClass")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getCanonicalName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\\t"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"服务不可用"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("p",[s._v("Controller类@SentinelResource注解演示")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@GetMapping")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/byResource"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@SentinelResource")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("value "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"byResource"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("blockHandlerClass "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CustomerBlockHandler")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("blockHandler "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"handlerException"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CommonResult")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("byResource")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CommonResult")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"按资源名称限流测试OK"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Payment")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020L")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"serial001"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("ul",[n("li",[s._v("如果资源名填的是【/byResource】则依然会走默认的处理方法")]),s._v(" "),n("li",[s._v("blockHandler 管控制台流控异常")]),s._v(" "),n("li",[s._v("fallback 管java/业务/运行时异常")])]),s._v(" "),n("h3",{attrs:{id:"规则持久化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#规则持久化"}},[s._v("#")]),s._v(" 规则持久化")]),s._v(" "),n("ul",[n("li",[s._v("加pom")])]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v(" sentinel持久化 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("alibaba"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("csp"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("groupId"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("sentinel"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("datasource"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nacos"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("artifactId"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("dependency"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("ul",[n("li",[s._v("yml 添加nacos数据源配置")])]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[s._v("# 配置nacos数据源\nspring"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  application"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" nacos"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("order"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("consumer\n  cloud"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    nacos"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      discovery"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n        server"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("addr"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".172")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".22")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1111")]),s._v(" # 配置"),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Nacos")]),s._v("地址\n    sentinel"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      transport"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n        dashboard"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".172")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".22")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("  #sentinel地址\n        # 默认"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8719")]),s._v("端口，假如占用会自动从"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8719")]),s._v("开始依次"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("扫描，直至找到未被占用的端口\n        port"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8719")]),s._v("\n      # 配置nacos数据源\n      datasource"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n        ds1"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n          nacos"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n            server"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("addr"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".172")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".22")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1111")]),s._v("\n            dataId"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" cloudalibaba"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("sentinel"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("service\n            groupId"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" DEFAULT_GROUP\n            data"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("type"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" json\n            rule"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("type"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" flow\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br")])]),n("ul",[n("li",[s._v("登录nacos新建配置，选json\n"),n("ul",[n("li",[s._v("resource:资源名称")]),s._v(" "),n("li",[s._v("limitApp:来源应用")]),s._v(" "),n("li",[s._v("grade:阈值类型，0表示线程数，1表示QPS")]),s._v(" "),n("li",[s._v("count:单机阈值")]),s._v(" "),n("li",[s._v("strategy:流控模式，0表示直接，1表示关联，2表示链路")]),s._v(" "),n("li",[s._v("controlBehavior:流控效果，0表示快速失败，1表示Warm up,2表示排队等待")]),s._v(" "),n("li",[s._v("clusterMode:是否集群")])])])]),s._v(" "),n("div",{staticClass:"language-json line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"resource"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/rateLimit/byUrl"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"limitApp"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"default"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"grade"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"count"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"strategy"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"controlBehavior"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"clusterMode"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[n("img",{attrs:{src:t(219),alt:"An image"}})]),s._v(" "),n("p",[s._v("接着发现能持久化了。\n其实也就是sentinel的配置放到nacos里去")]),s._v(" "),n("h2",{attrs:{id:"seata处理分布式事务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#seata处理分布式事务"}},[s._v("#")]),s._v(" Seata处理分布式事务")]),s._v(" "),n("h3",{attrs:{id:"官网-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#官网-2"}},[s._v("#")]),s._v(" 官网")]),s._v(" "),n("p",[s._v("https://seata.io/zh-cn/")]),s._v(" "),n("h3",{attrs:{id:"术语"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#术语"}},[s._v("#")]),s._v(" 术语")]),s._v(" "),n("ul",[n("li",[s._v("Transaction ID XID (非官网，分布式事务处理过程的-ID+三组件)")])]),s._v(" "),n("p",[s._v("全局唯一的事务ID")]),s._v(" "),n("ul",[n("li",[s._v("TC - 事务协调者")])]),s._v(" "),n("p",[s._v("维护全局和分支事务的状态，驱动全局事务提交或回滚。")]),s._v(" "),n("ul",[n("li",[s._v("TM - 事务管理器")])]),s._v(" "),n("p",[s._v("定义全局事务的范围：开始全局事务、提交或回滚全局事务。")]),s._v(" "),n("ul",[n("li",[s._v("RM - 资源管理器")])]),s._v(" "),n("p",[s._v("管理分支事务处理的资源，与TC交谈以注册分支事务和报告分支事务的状态，并驱动分支事务提交或回滚。")]),s._v(" "),n("p",[s._v("图解：")]),s._v(" "),n("p",[n("img",{attrs:{src:t(220),alt:"An image"}})]),s._v(" "),n("h3",{attrs:{id:"开始使用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#开始使用"}},[s._v("#")]),s._v(" 开始使用")]),s._v(" "),n("h4",{attrs:{id:"_1-设置数据源-file-conf"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-设置数据源-file-conf"}},[s._v("#")]),s._v(" 1.设置数据源 - file.conf")]),s._v(" "),n("p",[s._v("主要修改：自定义事务组名称+事务日志存储模式为db+数据库连接信息")]),s._v(" "),n("ul",[n("li",[s._v("自定义事务组名称 - service模块")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("br"),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br")]),n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('service {\n  #vgroup->rgroup\n  vgroup_mapping.my_test_tx_group = "fsp_tx_group"\n  #only support single node\n  default.grouplist = "127.0.0.1:8091"\n  #degrade current not support\n  enableDegrade = false\n  #disable\n  disable = false\n  #unit ms,s,m,h,d represents milliseconds, seconds, minutes, hours, days, default permanent\n  max.commit.retry.timeout = "-1"\n  max.rollback.retry.timeout = "-1"\n}\n\n')])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("ul",[n("li",[s._v("事务日志存储模式为db - store模块")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br")]),n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('## transaction log store\nstore {\n  ## store mode: file、db\n  mode = "db"       # file 换成db并指定数据库\n\n  ## file store\n  file {\n    dir = "sessionStore"\n\n    # branch session size , if exceeded first try compress lockkey, still exceeded throws exceptions\n    max-branch-session-size = 16384\n    # globe session size , if exceeded throws exceptions\n    max-global-session-size = 512\n    # file buffer size , if exceeded allocate new buffer\n    file-write-buffer-cache-size = 16384\n    # when recover batch read size\n    session.reload.read_size = 100\n    # async, sync\n    flush-disk-mode = async\n  }\n\n  ## database store\n  db {\n    ## the implement of javax.sql.DataSource, such as DruidDataSource(druid)/BasicDataSource(dbcp) etc.\n    datasource = "dbcp"\n    ## mysql/oracle/h2/oceanbase etc.\n    db-type = "mysql"\n    driver-class-name = "com.mysql.jdbc.Driver"\n    url = "jdbc:mysql://127.0.0.1:3306/seata"\n    user = "mysql"\n    password = "mysql"\n    min-conn = 1\n    max-conn = 3\n    global.table = "global_table"\n    branch.table = "branch_table"\n    lock-table = "lock_table"\n    query-limit = 100\n  }\n}\n')])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br")])]),n("ul",[n("li",[s._v("初始化db")])]),s._v(" "),n("p",[s._v("找到seata/conf/db_store.sql 初始化")]),s._v(" "),n("h4",{attrs:{id:"_2-设置注册中心-registry-conf"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-设置注册中心-registry-conf"}},[s._v("#")]),s._v(" 2.设置注册中心 - registry.conf")]),s._v(" "),n("p",[s._v("file 改成nacos，并设置nacos地址")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("br"),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("br"),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("br"),n("br"),n("br"),n("br")]),n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('registry {\n  # file 、nacos 、eureka、redis、zk、consul、etcd3、sofa\n  type = "file"\nnacos {\n    serverAddr = "localhost"\n    namespace = ""\n    cluster = "default"\n  }\n')])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("h4",{attrs:{id:"_3-准备3个数据库"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-准备3个数据库"}},[s._v("#")]),s._v(" 3.准备3个数据库")]),s._v(" "),n("p",[n("img",{attrs:{src:t(221),alt:"An image"}})]),s._v(" "),n("p",[s._v("从上到下依次是")]),s._v(" "),n("ul",[n("li",[s._v("账户信息库")]),s._v(" "),n("li",[s._v("订单库")]),s._v(" "),n("li",[s._v("库存库")])]),s._v(" "),n("p",[s._v("从上到下依次创建了相应的表")]),s._v(" "),n("p",[s._v("seata_account库")]),s._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" t_account"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'id'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BIGINT")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AUTO_INCREMENT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIMARY")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COMMENT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'id'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'user_id'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BIGINT")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COMMENT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'用户id'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'total'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DECIMAL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COMMENT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'总额度'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'used'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DECIMAL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COMMENT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'已用余额'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'residue'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DECIMAL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'0'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COMMENT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'剩余可用额度'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENGINE")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INNODB")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AUTO_INCREMENT")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CHARSET")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf8"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" seata_account"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("t_account"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'id'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'user_id'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'total'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'used'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'residue'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VALUES")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1000'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'0'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1000'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[s._v("seata_order库")]),s._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" t_order"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BIGINT")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AUTO_INCREMENT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIMARY")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("user_id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BIGINT")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COMMENT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'用户id'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("product_id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BIGINT")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COMMENT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'产品id'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("count"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INT")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COMMENT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'数量'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("money"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DECIMAL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COMMENT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'金额'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("status")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INT")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COMMENT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'订单状态：0：创建中; 1：已完结'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENGINE")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INNODB")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AUTO_INCREMENT")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CHARSET")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf8"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("seata_storage库")]),s._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" t_storage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'id'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BIGINT")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AUTO_INCREMENT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIMARY")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'product_id'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BIGINT")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COMMENT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'产品id'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'total'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INT")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COMMENT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'总库存'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'used'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INT")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COMMENT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'已用库存'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'residue'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INT")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COMMENT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'剩余库存'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENGINE")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INNODB")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AUTO_INCREMENT")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CHARSET")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf8"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" seata_storage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("t_storage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'id'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'product_id'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'total'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'used'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'residue'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VALUES")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'100'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'0'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'100'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("p",[s._v("订单-库存-账户3个库下都需要建各自的回滚日志表")]),s._v(" "),n("p",[s._v("\\seata-server-0.9.0\\seata\\conf目录下的db_undo_log.sql")]),s._v(" "),n("p",[s._v("最终效果")]),s._v(" "),n("p",[n("img",{attrs:{src:t(222),alt:"An image"}})]),s._v(" "),n("h4",{attrs:{id:"订单-库存-账户三个微服务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#订单-库存-账户三个微服务"}},[s._v("#")]),s._v(" 订单-库存-账户三个微服务")]),s._v(" "),n("p",[s._v("在主业务方法上加上下面注解就能做到分布式事务控制")]),s._v(" "),n("p",[s._v('@GlobalTransactional(name = "fsp_tx_group",rollbackFor = Exception.class)')]),s._v(" "),n("p",[s._v("@GlobalTransactional里当然还有很多属性，有时间深入研究")]),s._v(" "),n("h4",{attrs:{id:"分布式事务的执行流程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#分布式事务的执行流程"}},[s._v("#")]),s._v(" 分布式事务的执行流程")]),s._v(" "),n("ul",[n("li",[s._v("TM开启分布式事务(TM向TC注册全局事务记录)")]),s._v(" "),n("li",[s._v("换业务场景，编排数据库，服务等事务内资源（RM向TC汇报资源准备状态）")]),s._v(" "),n("li",[s._v("TM结束分布式事务，事务一阶段结束（TM通知TC提交/回滚分布式事务）")]),s._v(" "),n("li",[s._v("TC汇总事务信息，决定分布式事务是提交还是回滚")]),s._v(" "),n("li",[s._v("TC通知所有RM提交/回滚资源，事务二阶段结束。")])]),s._v(" "),n("p",[s._v("贴一张 TC - TM - RM 的理解图")]),s._v(" "),n("p",[n("img",{attrs:{src:t(223),alt:"An image"}})]),s._v(" "),n("h3",{attrs:{id:"seata-原理简介"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#seata-原理简介"}},[s._v("#")]),s._v(" Seata 原理简介")]),s._v(" "),n("h4",{attrs:{id:"一阶段加载"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一阶段加载"}},[s._v("#")]),s._v(" 一阶段加载")]),s._v(" "),n("p",[n("img",{attrs:{src:t(224),alt:"An image"}})]),s._v(" "),n("h4",{attrs:{id:"二阶段提交（正常情况）"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二阶段提交（正常情况）"}},[s._v("#")]),s._v(" 二阶段提交（正常情况）")]),s._v(" "),n("p",[n("img",{attrs:{src:t(164),alt:"An image"}})]),s._v(" "),n("h4",{attrs:{id:"二阶段回滚（异常情况）"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二阶段回滚（异常情况）"}},[s._v("#")]),s._v(" 二阶段回滚（异常情况）")]),s._v(" "),n("p",[n("img",{attrs:{src:t(164),alt:"An image"}})])])}),[],!1,null,null,null);a.default=e.exports}}]);